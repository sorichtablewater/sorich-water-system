<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SORICH TABLE WATER SYSTEM</title>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:linear-gradient(to bottom,#cceeff,#fff); transition:0.5s;}
    header {text-align:center;font-size:26px;font-weight:bold;color:#0066cc;padding:20px;}
    .time {text-align:center;font-size:14px;color:#333;margin-bottom:20px;}
    .container {width:90%;margin:auto;}
    button {margin:5px;padding:10px 15px;font-size:14px;border:none;border-radius:5px;cursor:pointer;transition:0.3s;}
    button:hover {background:#0066cc;color:#fff;}
    .stat-boxes {display:flex;gap:20px;flex-wrap:wrap;margin-bottom:20px;}
    .stat-box {flex:1;min-width:120px;background:#f0f8ff;padding:15px;border-radius:8px;text-align:center;font-weight:bold;color:#0066cc;}
    table {width:100%;border-collapse:collapse;margin-bottom:15px;}
    th,td {border:1px solid #0066cc;padding:8px;text-align:center;}
    th {background:#cceeff;}
    input, select {padding:5px;margin:3px;}
    .section {margin-bottom:30px;}
    body.dark-mode {background:#001f3f;color:#fff;}
    body.dark-mode table th, body.dark-mode table td {border-color:#fff;}
    body.dark-mode th {background-color:#003366;}
    .btn-debt {background-color:red;color:#fff;}
    .btn-expense {background-color:yellow;color:#000;}
    .invoice-modal {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:1000;}
    .invoice-content {background:#fff;padding:20px;width:90%;max-width:600px;border-radius:10px;overflow:auto;max-height:90%;}
    .invoice-content table {border:1px solid #000;}
    .invoice-content th, .invoice-content td {border:1px solid #000;padding:5px;}
    .close-btn {float:right;background:red;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;}
  </style>
</head>
<body>

<header>SORICH TABLE WATER â€” DRINK IT. LOVE IT</header>
<div class="time" id="liveTime"></div>
<div class="container">

  <!-- SALES PAGE -->
  <div id="salesPage" class="section" style="display:none;">
    <h2>Sales</h2>
    <label>Customer: <input type="text" id="saleCustomer" placeholder="New or select customer" oninput="prefillOwing()"></label>
    <label>Qty: <input type="number" id="saleQty" value="10"></label>
    <label>Total Amount: <input type="number" id="saleTotal" value="2500"></label>
    <label>Amount Paid: <input type="number" id="salePaid" value="2000"></label>
    <p>Unit Price: â‚¦<span id="saleUnitPrice">0</span> | Owing: â‚¦<span id="saleOwing">0</span></p>
    <button onclick="addSale()">Add Sale</button>
    <button onclick="printInvoice()">Print Invoice</button>
    <button onclick="backToDashboard()">Back to Dashboard</button>

    <h4>Live Summary:</h4>
    <p>Total Qty: <span id="sumQty">0</span> | Total Amount: â‚¦<span id="sumTotal">0</span> | Total Paid: â‚¦<span id="sumPaid">0</span> | Total Owing: â‚¦<span id="sumOwing">0</span> | Avg Unit Price: â‚¦<span id="avgPrice">0</span></p>

    <table id="salesTable">
      <tr><th>Customer</th><th>Qty</th><th>Total</th><th>Unit Price</th><th>Paid</th><th>Owing</th><th>ðŸ–¨</th></tr>
    </table>
  </div>

  <!-- INVOICE MODAL -->
  <div class="invoice-modal" id="invoiceModal">
    <div class="invoice-content" id="invoiceContent">
      <button class="close-btn" onclick="closeInvoiceModal()">X</button>
      <div id="invoiceBody"></div>
      <button onclick="printModalInvoice()">Print</button>
    </div>
  </div>

<script>
// =======================
// SALES LOGIC
// =======================
const saleQty=document.getElementById('saleQty'), saleTotal=document.getElementById('saleTotal'), salePaid=document.getElementById('salePaid');
function updateSaleCalc(){
  const q=parseFloat(saleQty.value)||0, t=parseFloat(saleTotal.value)||0, p=parseFloat(salePaid.value)||0;
  document.getElementById('saleUnitPrice').innerText=q?(t/q).toFixed(2):0;
  document.getElementById('saleOwing').innerText=(t-p).toFixed(2);
}
[saleQty,saleTotal,salePaid].forEach(e=>e.addEventListener('input',updateSaleCalc)); updateSaleCalc();

function addSale(){
  const customer=document.getElementById('saleCustomer').value||'Unknown';
  const qty=parseFloat(saleQty.value)||0, total=parseFloat(saleTotal.value)||0, paid=parseFloat(salePaid.value)||0;
  const unit=qty?(total/qty).toFixed(2):0, owing=(total-paid).toFixed(2);

  salesData.push({customer,qty,total,unit:parseFloat(unit),paid,owing:parseFloat(owing)});

  // SAVE TO LOCALSTORAGE
  localStorage.setItem('salesData', JSON.stringify(salesData));
}

// =======================
// INVOICE PRINTING
// =======================
function printInvoice(){
  const cur = document.getElementById('currency').value || 'â‚¦';
  const copies = 4; // Customer, Driver, Security, Manager

  const manager = document.getElementById('managerName').value || "Manager";
  const now = new Date();
  const date = now.toLocaleDateString();
  const time = now.toLocaleTimeString();
  const issuer = manager;

  const items = salesData;  // All sales data or use selected sale if necessary

  let fullHTML = "";

  const copyNames = ["CUSTOMER'S COPY", "DRIVER'S COPY", "SECURITY'S COPY", "MANAGER'S COPY"];

  items.forEach(sa => {
    for (let i = 0; i < copies; i++) {
      let copyType = copyNames[i];

      fullHTML += `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body { margin:0; font-family:Arial,sans-serif; }
table { width:100%; border-collapse:collapse; }
th, td { border:1px solid #000; padding:5px; text-align:center; }
</style>
</head>
<body>

<header style="text-align:center; font-size:22px; font-weight:bold;">
    SORICH CLASSY SERVICES
</header>

<div style="text-align:center; font-size:14px;">
    <p>PLOT 1 UGBSIS OFF UGBOGO, UDU ROAD, DELTA STATE</p>
    <p>08164084402, 07012623006, 08067338211</p>
    <p><strong>FACTORY SALE - ${copyType}</strong></p>
    <p><strong>RECEIPT:</strong> F${invoiceNumber}</p>
    <p><strong>DATE:</strong> ${date} | <strong>TIME:</strong> ${time}</p>
    <p><strong>ISSUER:</strong> ${issuer}</p>
</div>

<table>
<thead>
<tr>
    <th>DESCRIPTION</th>
    <th>QTY</th>
    <th>RATE</th>
    <th>AMOUNT</th>
</tr>
</thead>
<tbody>
<tr>
    <td>${sa.customer}</td>
    <td>${sa.qty}</td>
    <td>${Number(sa.unit).toLocaleString()}</td>
    <td>${Number(sa.total).toLocaleString()}</td>
</tr>
</tbody>
</table>

<div style="font-size:14px;">
    <p><strong>Sub Total:</strong> ${Number(sa.total).toLocaleString()}</p>
    <p><strong>Discount:</strong> 0.00</p>
    <p><strong>Grand Total:</strong> ${Number(sa.total).toLocaleString()}</p>
    <p><strong>Amount Paid:</strong> ${Number(sa.paid).toLocaleString()}</p>
    <p><strong>Balance:</strong> ${Number(sa.owing).toLocaleString()}</p>
</div>

<div style="text-align:center; margin-top:10px;">
    <p><strong>SORICH WATER, Drink it. Love it!</strong></p>
    <p>Thanks for your patronage!</p>
</div>

</body>
</html>
<br><br>
      `;
    });
  });

  invoiceNumber++;
  localStorage.setItem('invoiceNumber', invoiceNumber);

  showInvoiceModal(fullHTML);
}

function showInvoiceModal(html){ document.getElementById('invoiceBody').innerHTML=html; document.getElementById('invoiceModal').style.display='flex'; }
function closeInvoiceModal(){ document.getElementById('invoiceModal').style.display='none'; }
function printModalInvoice(){ const content=document.getElementById('invoiceContent').innerHTML; const w=window.open('','','width=600,height=600'); w.document.write(content); w.document.close(); w.print(); }
</script>
</body>
</html>

