<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SORICH TABLE WATER SYSTEM ‚Äî Dashboard</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:linear-gradient(to bottom,#cceeff,#fff); transition:0.5s;}
header {text-align:center;font-size:26px;font-weight:bold;color:#0066cc;padding:20px;}
.time {text-align:center;font-size:14px;color:#333;margin-bottom:20px;}
.container {width:90%;margin:auto;}
button {margin:5px;padding:10px 15px;font-size:14px;border:none;border-radius:5px;cursor:pointer;transition:0.3s;}
button:hover {background:#0066cc;color:#fff;}
.stat-boxes {display:flex;gap:20px;flex-wrap:wrap;margin-bottom:20px;}
.stat-box {flex:1;min-width:120px;background:#f0f8ff;padding:15px;border-radius:8px;text-align:center;font-weight:bold;color:#0066cc;}
table {width:100%;border-collapse:collapse;margin-bottom:15px;}
th,td {border:1px solid #0066cc;padding:8px;text-align:center;}
th {background:#cceeff;}
input, select {padding:5px;margin:3px;}
.section {margin-bottom:30px;}
body.dark-mode {background:#001f3f;color:#fff;}
body.dark-mode table th, body.dark-mode table td {border-color:#fff;}
body.dark-mode th {background-color:#003366;}
.invoice-modal {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;z-index:1000;}
.invoice-content {background:#fff;padding:20px;width:90%;max-width:600px;border-radius:10px;overflow:auto;max-height:90%;}
.close-btn {float:right;background:red;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;}
</style>

<!-- keep external library here if you need it -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

<header>SORICH TABLE WATER ‚Äî DRINK IT. LOVE IT</header>
<div class="time" id="liveTime"></div>
<div class="container">

<!-- DASHBOARD (visible after auth) -->
<div id="dashboardPage" class="section" style="display:none;">
  <h2>Main Dashboard</h2>
  <div class="stat-boxes">
    <div class="stat-box">üí∞ Total Sales: ‚Ç¶<span id="totalSales">0</span></div>
    <div class="stat-box">‚úÖ Total Paid: ‚Ç¶<span id="totalPaid">0</span></div>
    <div class="stat-box">üí≤ Expenses: ‚Ç¶<span id="expenses">0</span></div>
    <div class="stat-box">‚ùå Debts: ‚Ç¶<span id="debts">0</span></div>
    <div class="stat-box">üìà Avg Unit Price: ‚Ç¶<span id="avgUnitPrice">0</span></div>
  </div>

  <div class="dashboard-buttons">
    <button onclick="showSection('salesPage')">üõí Sales</button>
    <button onclick="showSection('debtorsPage')">üí≥ Debtors</button>
    <button onclick="showSection('expensesPage')">üí∞ Expenses</button>
    <button onclick="endOfDay()">üìÖ End of Day</button>
    <button onclick="showSection('dailyRecordsPage')">üìã Daily Records</button>
    <button onclick="showSection('chartsPage')">üìä Charts</button>
    <button onclick="settingsPage()">‚öô Settings</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<!-- SALES PAGE -->
<div id="salesPage" class="section" style="display:none;">
  <h2>Sales</h2>
  <label>Customer: <input type="text" id="saleCustomer" placeholder="New or select customer" oninput="prefillOwing()"></label>
  <label>Qty: <input type="number" id="saleQty" value="10"></label>
  <label>Total Amount: <input type="number" id="saleTotal" value="2500"></label>
  <label>Amount Paid: <input type="number" id="salePaid" value="2000"></label>
  <p>Unit Price: ‚Ç¶<span id="saleUnitPrice">0</span> | Owing: ‚Ç¶<span id="saleOwing">0</span></p>
  <button onclick="addSale()">Add Sale</button>
  <button onclick="printInvoice()">Print Invoice</button>
  <button onclick="backToDashboard()">Back to Dashboard</button>

  <h4>Live Summary:</h4>
  <p>Total Qty: <span id="sumQty">0</span> | Total Amount: ‚Ç¶<span id="sumTotal">0</span> | Total Paid: ‚Ç¶<span id="sumPaid">0</span> | Total Owing: ‚Ç¶<span id="sumOwing">0</span> | Avg Unit Price: ‚Ç¶<span id="avgPrice">0</span></p>

  <table id="salesTable">
    <tr><th>Customer</th><th>Qty</th><th>Total</th><th>Unit Price</th><th>Paid</th><th>Owing</th><th>üñ®</th></tr>
  </table>
</div>

<!-- DEBTORS PAGE -->
<div id="debtorsPage" class="section" style="display:none;">
  <h2>Debtors</h2>
  <table id="debtorsTable">
    <tr><th>Customer</th><th>Total Owed</th><th>Amount Paid</th><th>Balance</th><th>Status</th><th>Pay Now</th></tr>
  </table>
  <button onclick="backToDashboard()">Back to Dashboard</button>
</div>

<!-- EXPENSES PAGE -->
<div id="expensesPage" class="section" style="display:none;">
  <h2>Expenses & Profit</h2>
  <label>Type: <input type="text" id="expenseType"></label>
  <label>Description: <input type="text" id="expenseDesc"></label>
  <label>Amount: <input type="number" id="expenseAmount"></label>
  <label>Paid To: <input type="text" id="expensePaidTo"></label>
  <button onclick="addExpense()">Add Expense</button>
  <button onclick="clearMonthlyExpenses()">Clear Monthly Expenses</button>
  <button onclick="backToDashboard()">Back to Dashboard</button>

  <h4>Expenses Table:</h4>
  <table id="expensesTable">
    <tr><th>Type</th><th>Description</th><th>Amount</th><th>Paid To</th><th>Date</th></tr>
  </table>
  <p>Total Sales: ‚Ç¶<span id="expenseTotalSales">0</span> | Total Expenses: ‚Ç¶<span id="expenseTotal">0</span> | Profit: ‚Ç¶<span id="expenseProfit">0</span></p>
</div>

<!-- DAILY RECORDS PAGE -->
<div id="dailyRecordsPage" class="section" style="display:none;">
  <h2>Daily Records</h2>
  <table id="dailyTable">
    <tr><th>Date</th><th>Total Sales</th><th>Total Expenses</th><th>Net Balance</th><th>Avg Unit Price</th><th>View</th><th>Clear</th></tr>
  </table>
  <button onclick="backToDashboard()">Back to Dashboard</button>
</div>

<!-- CHARTS PAGE -->
<div id="chartsPage" class="section" style="display:none;">
  <h2>Top Buying Customers (Text-Based)</h2>
  <pre id="chartText"></pre>
  <button onclick="backToDashboard()">Back to Dashboard</button>
</div>

<!-- SETTINGS PAGE -->
<div id="settingsPage" class="section" style="display:none;">
  <h2>Settings</h2>
  <label>Dark Mode: <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()"></label><br>
  <label>Background Color: <input type="color" id="bgColorPicker" onchange="updateBgColor()"></label><br>
  <label>Manager Name: <input type="text" id="managerName"></label><br>
  <label>Contact Phone 1: <input type="text" id="contact1"></label><br>
  <label>Invoice Footer: <input type="text" id="invoiceFooter" value="Drink It. Love It."></label><br>
  <label>Invoice Copies: <input type="number" id="invoiceCopies" value="4"></label><br><br>
  <button onclick="backToDashboard()">Back to Dashboard</button>
</div>

</div> <!-- container -->

<script>
// ====== Credentials read from index.html via GET params ======
function getQueryParams() {
  const q = {};
  location.search.substring(1).split("&").forEach(pair => {
    if(!pair) return;
    const [k,v] = pair.split("=");
    q[decodeURIComponent(k)] = decodeURIComponent(v||"");
  });
  return q;
}

// ====== Offline JS Logic (full app) ======
let loginCredentials = { username: 'admin', password: 'admin' };
let salesData = JSON.parse(localStorage.getItem('salesData')) || [];
let debtData = JSON.parse(localStorage.getItem('debtData')) || [];
let expenseData = JSON.parse(localStorage.getItem('expenseData')) || [];
let dailyData = JSON.parse(localStorage.getItem('dailyData')) || [];
let invoiceNumber = parseInt(localStorage.getItem('invoiceNumber')) || 1;

// ====== AUTH CHECK (run on load) ======
function checkAuthOrRedirect() {
  const params = getQueryParams();
  const u = (params.u || '').trim();
  const p = (params.p || '').trim();
  if(u === loginCredentials.username && p === loginCredentials.password) {
    // authenticated -> show dashboard
    showSection('dashboardPage');
    // remove query string from URL for cleaner bookmark
    if(history.replaceState) history.replaceState(null, '', location.pathname);
  } else {
    // not authenticated -> go back to login
    alert('Authentication required. Redirecting to login.');
    window.location.href = 'index.html';
  }
}

// ====== TIME ======
function updateTime(){ document.getElementById('liveTime').innerText=new Date().toLocaleString();}
setInterval(updateTime,1000); updateTime();

// ====== NAV / UI ======
function logout(){ window.location.href = 'index.html'; }
function showSection(id){
  ['dashboardPage','salesPage','debtorsPage','expensesPage','dailyRecordsPage','chartsPage','settingsPage']
  .forEach(s=>{ const el = document.getElementById(s); if(el) el.style.display='none'; });
  const target = document.getElementById(id);
  if(target) target.style.display='block';
  if(id==='chartsPage') renderChart();
  if(id==='debtorsPage') renderDebtors();
}
function backToDashboard(){ showSection('dashboardPage'); }
function toggleDarkMode(){ document.body.classList.toggle('dark-mode'); }
function updateBgColor(){ document.body.style.background=document.getElementById('bgColorPicker').value; }
function settingsPage(){ showSection('settingsPage'); }

// ====== SALES ======
const saleQty = document.getElementById('saleQty'), saleTotal = document.getElementById('saleTotal'), salePaid = document.getElementById('salePaid');
function updateSaleCalc(){
  if(!saleQty || !saleTotal || !salePaid) return;
  const q = parseFloat(saleQty.value)||0, t = parseFloat(saleTotal.value)||0, p = parseFloat(salePaid.value)||0;
  document.getElementById('saleUnitPrice').innerText = q ? (t/q).toFixed(2) : 0;
  document.getElementById('saleOwing').innerText = (t-p).toFixed(2);
}
if(saleQty && saleTotal && salePaid) {
  [saleQty,saleTotal,salePaid].forEach(e=>e.addEventListener('input',updateSaleCalc));
  updateSaleCalc();
}

function prefillOwing(){
  const name = (document.getElementById('saleCustomer').value || '').trim();
  const debt = debtData.find(d=>d.customer.toLowerCase()===name.toLowerCase());
  if(debt) { const total = parseFloat(document.getElementById('saleTotal').value)||0; document.getElementById('salePaid').value = total - debt.owing; }
  updateSaleCalc();
}

function addSale(){
  const customer = document.getElementById('saleCustomer').value || 'Unknown';
  const qty = parseFloat(saleQty.value)||0, total = parseFloat(saleTotal.value)||0, paid = parseFloat(salePaid.value)||0;
  const unit = qty ? (total/qty).toFixed(2) : 0, owing = (total-paid).toFixed(2);
  salesData.push({customer, qty, total, unit:parseFloat(unit), paid, owing:parseFloat(owing), date: new Date().toLocaleDateString()});
  const debtIndex = debtData.findIndex(d=>d.customer.toLowerCase()===customer.toLowerCase());
  if(debtIndex>=0){ debtData[debtIndex].owing += parseFloat(owing); debtData[debtIndex].totalPaid += paid; } 
  else { debtData.push({customer, owing:parseFloat(owing), totalPaid:paid}); }
  renderSalesTable(); renderDebtors();
  document.getElementById('saleCustomer').value=''; saleQty.value=10; saleTotal.value=2500; salePaid.value=2000; updateSaleCalc();
  localStorage.setItem('salesData', JSON.stringify(salesData));
  localStorage.setItem('debtData', JSON.stringify(debtData));
}

function renderSalesTable(){
  const table=document.getElementById('salesTable');
  if(!table) return;
  table.innerHTML='<tr><th>Customer</th><th>Qty</th><th>Total</th><th>Unit Price</th><th>Paid</th><th>Owing</th><th>üñ®</th></tr>';
  let sumQty=0,sumTotal=0,sumPaid=0,sumOwing=0, unitSum=0;
  salesData.forEach(s=>{
    const row=table.insertRow();
    row.insertCell(0).innerText=s.customer;
    row.insertCell(1).innerText=s.qty;
    row.insertCell(2).innerText=s.total;
    row.insertCell(3).innerText=s.unit;
    row.insertCell(4).innerText=s.paid;
    row.insertCell(5).innerText=s.owing;
    const btn=document.createElement('button'); btn.innerText='Print'; btn.onclick=()=>printInvoice(s); row.insertCell(6).appendChild(btn);
    sumQty+=s.qty; sumTotal+=s.total; sumPaid+=s.paid; sumOwing+=s.owing; unitSum+=s.unit;
  });
  const avgUnit = salesData.length ? (unitSum/salesData.length).toFixed(2) : 0;
  if(document.getElementById('sumQty')) document.getElementById('sumQty').innerText=sumQty;
  if(document.getElementById('sumTotal')) document.getElementById('sumTotal').innerText=sumTotal;
  if(document.getElementById('sumPaid')) document.getElementById('sumPaid').innerText=sumPaid;
  if(document.getElementById('sumOwing')) document.getElementById('sumOwing').innerText=sumOwing;
  if(document.getElementById('avgPrice')) document.getElementById('avgPrice').innerText=avgUnit;
  if(document.getElementById('totalSales')) document.getElementById('totalSales').innerText=sumTotal;
  if(document.getElementById('totalPaid')) document.getElementById('totalPaid').innerText=sumPaid;
  const totalDebt = debtData.reduce((acc,d)=>acc+(d.owing||0),0);
  if(document.getElementById('debts')) document.getElementById('debts').innerText=totalDebt.toFixed(2);
  if(document.getElementById('avgUnitPrice')) document.getElementById('avgUnitPrice').innerText=avgUnit;
}

// ====== DEBTORS ======
function renderDebtors(){
  const table=document.getElementById('debtorsTable');
  if(!table) return;
  table.innerHTML='<tr><th>Customer</th><th>Total Owed</th><th>Amount Paid</th><th>Balance</th><th>Status</th><th>Pay Now</th></tr>';
  debtData.forEach(d=>{
    const row=table.insertRow();
    row.insertCell(0).innerText=d.customer;
    row.insertCell(1).innerText=( (d.owing||0) + (d.totalPaid||0) ).toFixed(2);
    row.insertCell(2).innerText=(d.totalPaid||0).toFixed(2);
    row.insertCell(3).innerText=(d.owing||0).toFixed(2);
    row.insertCell(4).innerText=(d.owing>0)?'‚ùå':'‚úÖ';
    const btn=document.createElement('button'); btn.innerText='Pay'; btn.onclick=()=>{ const payment = parseFloat(prompt('Enter payment amount',d.owing))||0; d.owing -= payment; d.totalPaid += payment; renderDebtors(); renderSalesTable(); localStorage.setItem('debtData', JSON.stringify(debtData)); };
    row.insertCell(5).appendChild(btn);
  });
}

// ====== INVOICE PRINTING ======
function printInvoice(sale){
  const copies = parseInt(document.getElementById('invoiceCopies')?.value) || 4;
  const m = document.getElementById('managerName')?.value || 'Manager';
  const f = document.getElementById('invoiceFooter')?.value || 'Drink It. Love It.';
  const now = new Date();
  const customer = sale ? sale.customer : (document.getElementById('saleCustomer')?.value || 'Customer');
  const qty = sale ? sale.qty : (parseFloat(document.getElementById('saleQty')?.value) || 0);
  const total = sale ? sale.total : (parseFloat(document.getElementById('saleTotal')?.value) || 0);
  const paid = sale ? sale.paid : (parseFloat(document.getElementById('salePaid')?.value) || 0);
  const unit = sale ? sale.unit : (qty ? (total/qty).toFixed(2) : 0);
  const owing = (total - paid).toFixed(2);

  const win=window.open('','PRINT','width=600,height=800');
  for(let i=0;i<copies;i++){
    const copyName=['Customer','Driver','Security','Manager'][i]||'Copy';
    win.document.write(`<h2>SORICH CLASSY SERVICES</h2><p>PLOT 1 UGBSIS OFF UGBOGO, UDU ROAD, DELTA STATE</p><p>08164084402, 07012623006, 08067338211</p><h3>FACTORY SALE - ${copyName.toUpperCase()} COPY</h3><p>RECEIPT: F${invoiceNumber}</p><p>DATE: ${now.toLocaleDateString()} TIME: ${now.toLocaleTimeString()}</p><p>ISSUER: ${m}</p><hr>`);
    win.document.write(`<p>DESCRIPTION | QTY | UNIT | TOTAL | PAID | OWING</p><p>${customer} | ${qty} | ${unit} | ${total} | ${paid} | ${owing}</p><p>${f}</p><hr>`);
  }
  win.document.close(); win.focus(); win.print(); win.close();
  invoiceNumber++; localStorage.setItem('invoiceNumber',invoiceNumber);
}

// ====== EXPENSES ======
function addExpense(){
  const type=document.getElementById('expenseType').value||'General';
  const desc=document.getElementById('expenseDesc').value||'No description';
  const amount=parseFloat(document.getElementById('expenseAmount').value)||0;
  const paidTo=document.getElementById('expensePaidTo').value||'Unknown';
  const date=new Date().toLocaleString();
  expenseData.push({type,desc,amount,paidTo,date});
  localStorage.setItem('expenseData', JSON.stringify(expenseData));
  renderExpenses();
}
function renderExpenses(){
  const table=document.getElementById('expensesTable');
  if(!table) return;
  table.innerHTML='<tr><th>Type</th><th>Description</th><th>Amount</th><th>Paid To</th><th>Date</th></tr>';
  let totalExpense=0;
  expenseData.forEach(e=>{
    const row=table.insertRow();
    row.insertCell(0).innerText=e.type;
    row.insertCell(1).innerText=e.desc;
    row.insertCell(2).innerText=e.amount;
    row.insertCell(3).innerText=e.paidTo;
    row.insertCell(4).innerText=e.date;
    totalExpense+=e.amount;
  });
  if(document.getElementById('expenses')) document.getElementById('expenses').innerText=totalExpense;
  const totalSales = salesData.reduce((acc,s)=>acc+s.total,0);
  if(document.getElementById('expenseTotalSales')) document.getElementById('expenseTotalSales').innerText=totalSales;
  if(document.getElementById('expenseTotal')) document.getElementById('expenseTotal').innerText=totalExpense;
  if(document.getElementById('expenseProfit')) document.getElementById('expenseProfit').innerText=(totalSales-totalExpense).toFixed(2);
}
function clearMonthlyExpenses(){ if(confirm('Clear all expenses?')){ expenseData=[]; localStorage.setItem('expenseData','[]'); renderExpenses(); }}

// ====== DAILY RECORDS ======
function renderDailyRecords() {
    const table = document.getElementById('dailyTable');
    if(!table) return;
    table.innerHTML = '<tr><th>Date</th><th>Total Sales</th><th>Total Expenses</th><th>Net Balance</th><th>Avg Unit Price</th><th>View</th><th>Clear</th></tr>';

    dailyData.forEach((d, index) => {
        const row = table.insertRow();
        row.insertCell(0).innerText = d.date;
        row.insertCell(1).innerText = d.totalSales.toFixed(2);
        row.insertCell(2).innerText = d.totalExpenses.toFixed(2);
        row.insertCell(3).innerText = d.net.toFixed(2);
        row.insertCell(4).innerText = d.avgUnitPrice.toFixed(2);

        // View button ‚Äî opens invoice-style window
        const viewBtn = document.createElement('button');
        viewBtn.innerText = 'View';
        viewBtn.onclick = () => {
            const copies = parseInt(document.getElementById('invoiceCopies')?.value) || 4;
            const manager = document.getElementById('managerName')?.value || 'Manager';
            const footer = document.getElementById('invoiceFooter')?.value || 'Drink It. Love It.';
            const win = window.open('', '', 'width=600,height=800');

            for (let i = 0; i < copies; i++) {
                const copyName = ['Customer','Driver','Security','Manager'][i] || 'Copy';
                win.document.write(`<h2>SORICH CLASSY SERVICES</h2>
<p>PLOT 1 UGBSIS OFF UGBOGO, UDU ROAD, DELTA STATE</p>
<p>08164084402, 07012623006, 08067338211</p>
<h3>DAILY RECORD - ${copyName.toUpperCase()} COPY</h3>
<p>DATE: ${d.date}</p>
<p>ISSUER: ${manager}</p>
<hr>
<h4>SALES</h4>
<table border="1" cellpadding="5" cellspacing="0">
<tr><th>Customer</th><th>Qty</th><th>Unit</th><th>Total</th><th>Paid</th><th>Owing</th></tr>`);

                d.sales.forEach(s => {
                    win.document.write(`<tr>
<td>${s.customer}</td>
<td>${s.qty}</td>
<td>${s.unit}</td>
<td>${s.total}</td>
<td>${s.paid}</td>
<td>${s.owing}</td>
</tr>`);
                });

                win.document.write(`</table>
<h4>EXPENSES</h4>
<table border="1" cellpadding="5" cellspacing="0">
<tr><th>Type</th><th>Description</th><th>Amount</th><th>Paid To</th></tr>`);

                d.expenses.forEach(e => {
                    win.document.write(`<tr>
<td>${e.type}</td>
<td>${e.desc}</td>
<td>${e.amount}</td>
<td>${e.paidTo}</td>
</tr>`);
                });

                win.document.write(`</table>
<p>Total Sales: ‚Ç¶${d.totalSales.toFixed(2)}</p>
<p>Total Expenses: ‚Ç¶${d.totalExpenses.toFixed(2)}</p>
<p>Net: ‚Ç¶${d.net.toFixed(2)}</p>
<p>${footer}</p>
<hr>`);
            }

            win.document.close();
            win.focus();
            win.print();
            win.close();
        };

        row.insertCell(5).appendChild(viewBtn);

        // Clear button
        const clearBtn = document.createElement('button');
        clearBtn.innerText = 'Clear';
        clearBtn.onclick = () => {
            if(confirm('Delete this daily record?')) {
                dailyData.splice(index, 1);
                localStorage.setItem('dailyData', JSON.stringify(dailyData));
                renderDailyRecords();
            }
        };
        row.insertCell(6).appendChild(clearBtn);
    });
}

// ====== END OF DAY ======
function endOfDay() {
    if (!confirm("Close the day? Today's sales and expenses will be archived.")) return;

    const todayStr = new Date().toLocaleDateString();

    const totalSales = salesData.reduce((acc, s) => acc + s.total, 0);
    const totalExpenses = expenseData.reduce((acc, e) => acc + e.amount, 0);
    const avgUnitPrice = salesData.length ? (salesData.reduce((acc, s) => acc + s.unit, 0) / salesData.length) : 0;

    dailyData.push({
        date: todayStr,
        totalSales,
        totalExpenses,
        net: totalSales - totalExpenses,
        avgUnitPrice,
        sales: [...salesData],
        expenses: [...expenseData]
    });

    localStorage.setItem('dailyData', JSON.stringify(dailyData));

    salesData = [];
    expenseData = [];
    localStorage.setItem('salesData', JSON.stringify(salesData));
    localStorage.setItem('expenseData', JSON.stringify(expenseData));

    renderSalesTable();
    renderExpenses();
    renderDailyRecords();

    alert("End of day completed! Today's sales and expenses archived.");
}

// ====== SIMPLE CHART (text-based) ======
function renderChart(){
  const text = document.getElementById('chartText');
  if(!text) return;
  // top buyers by total
  const totals = {};
  salesData.forEach(s => { totals[s.customer] = (totals[s.customer]||0) + s.total; });
  const sorted = Object.entries(totals).sort((a,b)=>b[1]-a[1]).slice(0,10);
  text.innerText = sorted.map((r,i)=>`${i+1}. ${r[0]} ‚Äî ‚Ç¶${r[1].toFixed(2)}`).join('\n') || 'No sales yet';
}

// ====== INIT ======
function initApp(){
  renderSalesTable();
  renderDebtors();
  renderExpenses();
  renderDailyRecords();
  // Auth
  checkAuthOrRedirect();
}

// small helper to render expenses safely even if DOM not ready
function renderExpenses(){ try{ renderExpenses = renderExpenses; /* placeholder to avoid lint */ }catch(e){} }
window.addEventListener('DOMContentLoaded', () => {
  // call init AFTER DOM ready
  initApp();
});
</script>
</body>
</html>
